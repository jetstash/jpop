/**
Version: 1.0.2
Build: Tue, 15 Dec 2015 20:02:08 GMT

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see https://github.com/jetstash/jpop/blob/master/LICENSE.

Copyright (c) 2015 Jetstash LLC
**/
!function(o){"use strict";function t(t,e){var i={form:null,type:"banner",position:"top",zindex:8675309,show:!1,delay:500,scroll:!1,title:"Subscribe to our email list",button:"Submit",thanks:"Thanks",cookie:!0,expires:2592e3};this.el=t,this.loaded=!1,this.options=o.extend(i,e),this.output={error:!1,message:this.options.thanks},this.endpoint="https://api.jetstash.com/v1/form/submit",this.message={incorrectType:"Incorrect type set. Check your options.",incorrectForm:"You must pass your form id as an option",generalError:"Something went wrong, please refresh and try again."}}t.prototype.run=function(){if(!this.options.cookie||!this.checkCookieExists())if(this.loadListeners(),null!==this.options.form)switch(this.options.type){case"banner":this.loadBanner();break;case"popover":this.loadPopOver();break;default:console.log(this.message.incorrectType)}else console.log(this.message.incorrectForm)},t.prototype.loadListeners=function(){var t=this;o("body").on("submit","form#jpop",function(e){var i=o("#jpop-email").val(),p=o("form#jpop").find("button");e.preventDefault(),t.verifyData(i),t.output.error===!1?(p.attr("disabled",!0),o.post(t.endpoint,{form:t.options.form,email:i},function(e){e=JSON.parse(e),e.success===!0?(o("#jpop *").remove(),o("#jpop").append('<div id="jpop-success" class="jpop-success"><p>'+t.output.message+"</p></div>"),t.loadCustomEvent("jpop-success")):e.success===!1?(t.output={error:!0,message:e.message},p.attr("disabled",!1),t.appendError()):(t.output={error:!0,message:t.message.generalError},p.attr("disabled",!1),t.appendError())})):t.appendError()}),o("body").on("click","#jpop-popover",function(e){"jpop-popover"===e.target.id&&t.clearJpop(o(this).data("type"))}),o("body").on("click","#jpop-dismiss",function(){t.clearJpop(o(this).data("type"))})},t.prototype.loadCustomEvent=function(t,e){var i={dismissed:!1};e=e||{},i=o.extend(i,e),o.event.trigger({type:t,state:i})},t.prototype.verifyData=function(o){var t=/\S+@\S+\.\S+/;""===o&&(this.output={error:!0,message:this.message.emptyEmail}),!1===t.test(o)&&(this.output={error:!0,message:this.message.invalidEmail})},t.prototype.appendError=function(){o("#jpop-error").empty().append("<p>"+this.output.message+"</p>")},t.prototype.inject=function(t){var e,i,p=this;this.options.show?(this.el.append(t),this.loadCustomEvent("jpop-displayed"),this.createCookie()):this.options.scroll?o(window).on("scroll mousewheel",function(){p.loaded||(p.el.append(t),p.loaded=!0,p.loadCustomEvent("jpop-displayed"),p.createCookie())}):(e=setInterval(function(){p.el.append(t),p.loadCustomEvent("jpop-displayed"),p.createCookie(),i()},this.options.delay),i=function(){clearInterval(e)})},t.prototype.clearJpop=function(t){o("#jpop-backdrop, #jpop-"+t).remove(),this.loadCustomEvent("jpop-dismissed",{dismissed:!0})},t.prototype.loadBanner=function(){var o=this.htmlBanner();this.inject(o)},t.prototype.loadPopOver=function(){var o=this.htmlPopOver();this.inject(o)},t.prototype.htmlBanner=function(){var o="top"===this.options.position?"slideInDown":"slideInUp";return['<div id="jpop-banner" data-type="banner" class="jpop-banner animated '+o+'" style="position:fixed;z-index:'+this.options.zindex+";width:100%;left:0;right:0;"+this.options.position+':0;">','<div class="jpop-left">','<h2 class="jpop-cta">'+this.options.title+"</h2>","</div>",'<div class="jpop-right">',this.htmlForm(),"</div>",'<a id="jpop-dismiss" class="jpop-dismiss white" data-type="banner">&times;</a>',"</div>"].join("\n")},t.prototype.htmlPopOver=function(){return['<div id="jpop-popover" data-type="popover" class="jpop-popover animated zoomIn" style="position:fixed;z-index:'+this.options.zindex+';top:0;right:0;bottom:0;left:0">','<div class="jpop-content">','<a id="jpop-dismiss" class="jpop-dismiss orange" data-type="popover">&times;</a>','<h1 class="jpop-cta">'+this.options.title+"</h1>",this.htmlForm(),"</div>","</div>",'<div id="jpop-backdrop" class="jpop-backdrop animated fadeIn" data-type="popover"></div>'].join("\n")},t.prototype.htmlForm=function(){return['<form id="jpop" role="form" class="jpop-form">','<label class="sr-only" for="jpop-email">Email</label>','<input type="email" id="jpop-email" class="jpop-input" name="email" placeholder="email" required>','<button class="jpop-btn btn-default" type="submit">'+this.options.button+"</button>",'<div id="jpop-error" class="jpop-error"></div>',"</form>"].join("\n")},t.prototype.createCookie=function(){this.options.cookie&&(document.cookie="jpop=true;max-age="+this.options.duration)},t.prototype.checkCookieExists=function(){return document.cookie.indexOf("jpop")>-1?!0:!1},o.fn.jpop=function(o){var e=new t(this,o);e.run()}}(jQuery);